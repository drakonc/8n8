version: "3.8"

services:
    traefik:
        image: "traefik"
        restart: always
        command:
            - "--providers.docker=true"
            - "--providers.docker.exposedbydefault=false"
            - "--entrypoints.web.address=:80"
            - "--entrypoints.websecure.address=:443"
            - "--certificatesresolvers.mytlschallenge.acme.tlschallenge=true"
            - "--certificatesresolvers.mytlschallenge.acme.email=${SSL_EMAIL}"
            - "--certificatesresolvers.mytlschallenge.acme.storage=/letsencrypt/acme.json"
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock:ro
        networks:
            - proxy-net # ðŸ‘ˆ red compartida

    n8n:
        image: docker.n8n.io/n8nio/n8n
        restart: always
        environment:
            - N8N_HOST=n8n.jdevelopmen.xyz
            - N8N_PORT=5678
            - N8N_PROTOCOL=https
            - NODE_ENV=production
            - WEBHOOK_URL=https://n8n.jdevelopmen.xyz/
            - GENERIC_TIMEZONE=America/Bogota
        volumes:
            - n8n_data:/home/node/.n8n
            - ./local-files:/files
        networks:
            - proxy-net # ðŸ‘ˆ red compartida
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.n8n.rule=Host(`n8n.jdevelopmen.xyz`)"
            - "traefik.http.routers.n8n.entrypoints=websecure"
            - "traefik.http.routers.n8n.tls.certresolver=mytlschallenge"
            - "traefik.http.services.n8n.loadbalancer.server.port=5678"

volumes:
    n8n_data:

networks:
    proxy-net: # ðŸ‘ˆ red declarada
